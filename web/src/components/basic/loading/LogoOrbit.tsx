import { useEffect, useId, useState } from 'react';

export interface LogoOrbitProps {
  /**
   * Size of the logo in pixels
   */
  size?: number;
  /**
   * Speed of the orbital animation (lower is faster)
   */
  speed?: number;
  /**
   * Number of orbital cycles to complete (0 or undefined for infinite)
   */
  cycles?: number;
  /**
   * Callback function when animation completes a full orbit
   */
  onOrbitComplete?: () => void;
  /**
   * Optional additional classes
   */
  className?: string;
}

export default function LogoOrbit({
  size = 100,
  speed = 2,
  cycles,
  onOrbitComplete,
  className = '',
}: LogoOrbitProps) {
  const [orbitalAngle, setOrbitalAngle] = useState(0);
  const [currentCycle, setCurrentCycle] = useState(0);
  const [isRunning, setIsRunning] = useState(true);
  const id = useId();
  const orbitPathId = `orbital-path-${id}`;
  const gradientId = `logo-gradient-${id}`;
  const clipPathId = `clip-path-${id}`;

  // Calculate orbital position
  const calculateOrbitalPosition = (angle: number) => {
    // Center of the orbit path (relative to the 200x200 viewBox)
    const centerX = 99;
    const centerY = 160;

    // Radius of the orbit (based on the SVG path)
    const radiusX = 12; // horizontal radius
    const radiusY = 12; // vertical radius

    // Convert angle to radians
    const radians = (angle * Math.PI) / 180;

    // Calculate position
    const x = centerX + radiusX * Math.cos(radians);
    const y = centerY + radiusY * Math.sin(radians);

    return { x, y };
  };

  useEffect(() => {
    if (!isRunning) return;

    let animationFrame: number;
    let lastOrbitCompleted = 0;

    const animate = () => {
      setOrbitalAngle((prevAngle) => {
        const newAngle = (prevAngle + 1) % 360;

        // Detect full orbit completion
        if (newAngle < prevAngle) {
          const now = Date.now();
          // Prevent multiple callbacks if frame rate is high
          if (now - lastOrbitCompleted > 500) {
            // Increment cycle counter
            const nextCycle = currentCycle + 1;
            setCurrentCycle(nextCycle);

            // Check if we've reached the cycle limit
            if (cycles && nextCycle >= cycles) {
              setIsRunning(false);
            }

            if (onOrbitComplete) {
              onOrbitComplete();
            }

            lastOrbitCompleted = now;
          }
        }

        return newAngle;
      });

      if (isRunning) {
        animationFrame = requestAnimationFrame(animate);
      }
    };

    animationFrame = requestAnimationFrame(animate);

    return () => cancelAnimationFrame(animationFrame);
  }, [onOrbitComplete, speed, currentCycle, cycles, isRunning]);

  // Calculate the position of the orbital dot
  const orbitalPosition = calculateOrbitalPosition(orbitalAngle);

  return (
    <div className={className} style={{ width: size, height: size }}>
      <svg
        viewBox="0 0 200 200"
        width={size}
        height={size}
        aria-label="Loading"
      >
        <defs>
          <linearGradient id={gradientId} x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#4f46e5" stopOpacity="1" />
            <stop offset="100%" stopColor="#6366f1" stopOpacity="1" />
          </linearGradient>
          <clipPath id={clipPathId}>
            <rect x="0" y="0" width="200" height="200" />
          </clipPath>
        </defs>

        {/* Main atom shape */}
        <path
          d="M170.800,75.217C152.608,67.467,128.166,62.467,102.050,61.092C97.883,60.842,93.825,60.758,89.967,60.758C109.283,37.175,135.000,27.658,141.500,27.158Q148.000,26.658,148.000,27.158Q152.500,27.158,154.591,31.500Q157.925,37.208,154.925,52.392C154.591,54.475,155.925,56.500,157.925,56.892C160.008,57.308,162.008,55.975,162.425,53.892C166.175,34.892,163.425,21.842,154.591,16.075C151.425,14.008,147.591,13.033,143.341,13.192C126.258,13.833,102.175,32.358,80.092,60.858C70.475,61.150,61.425,61.942,53.158,63.250C47.775,39.108,54.592,30.000,56.142,27.158C58.500,23.500,61.283,20.283,66.333,20.283C68.163,20.283,71.087,20.846,74.164,22.018C79.367,24.000,80.092,25.000,84.500,27.158C86.117,28.492,88.550,28.325,89.883,26.658C91.230,25.036,91.006,22.629,89.383,21.283C78.883,12.583,69.200,8.333,61.283,8.917C58.958,9.105,56.688,9.727,54.592,10.750C44.675,15.808,40.675,30.142,43.175,51.067C43.758,55.400,44.508,59.917,45.592,64.567C18.250,70.033,0.750,80.983,-0.000,94.767C-0.500,104.517,7.292,113.800,22.417,121.617C24.317,122.770,26.796,122.070,27.813,120.094C28.831,118.118,27.959,115.693,25.917,114.817C13.833,108.600,14.608,101.183,15.000,94.767C15.417,85.767,22.492,76.917,47.392,72.000C49.642,80.283,52.558,88.933,56.142,97.750C47.658,113.484,41.508,128.975,38.333,142.750C33.667,163.292,36.167,177.917,45.500,183.984C48.500,185.934,52.000,186.900,55.892,186.900C63.683,186.900,73.117,183.067,83.783,175.467C85.610,174.287,86.083,171.823,84.824,170.050C83.565,168.278,81.082,167.914,79.367,169.250C72.350,173.375,66.845,176.021,63.500,177.000C60.083,178.000,55.658,177.000,53.158,174.792C51.049,172.929,47.392,170.050,45.850,163.500C45.500,160.500,43.908,152.946,45.850,144.475C48.517,132.925,53.408,120.059,60.083,106.808C61.750,110.459,63.500,114.109,65.333,117.750C77.208,141.050,91.750,161.309,106.250,174.792C117.800,185.542,128.533,191.150,137.375,191.150C140.291,191.150,143.041,190.525,145.508,189.292C155.050,184.417,159.175,170.875,157.158,151.167C155.291,132.725,148.325,110.250,137.541,87.833C136.667,85.858,134.335,84.995,132.385,85.925C130.436,86.855,129.640,89.211,130.625,91.133C153.041,137.817,154.083,169.050,141.500,175.467C128.250,182.242,96.842,162.842,72.125,114.300C69.292,108.842,66.817,103.467,64.625,98.217C67.458,93.150,70.458,88.050,73.750,82.967C77.042,77.933,80.467,73.067,83.950,68.425L87.233,68.425C91.733,68.425,96.617,68.508,101.683,68.825C156.100,71.683,185.758,90.558,185.000,105.342C184.667,111.717,184.683,117.759,172.175,122.609C170.219,123.397,169.255,125.606,170.008,127.575C170.757,129.555,173.005,130.538,174.950,129.759C190.825,123.592,199.500,115.125,200.000,105.342C200.583,94.258,190.283,83.592,170.867,75.342L170.867,75.258L170.800,75.217ZM67.333,78.750C65.083,82.208,63.000,85.642,60.967,89.117C58.656,83.067,56.646,76.906,54.942,70.658C60.883,69.742,67.317,69.075,74.192,68.658C71.858,71.908,69.575,75.275,67.358,78.742L67.358,78.658L67.333,78.750Z"
          fill="currentColor"
          opacity="0.7"
          className="text-indigo-600 dark:text-indigo-500"
        />

        {/* First orbital circle */}
        <path
          d="M114.583,101.542Q114.583,101.861,114.568,102.180Q114.552,102.498,114.521,102.816Q114.489,103.133,114.443,103.449Q114.396,103.765,114.334,104.078Q114.271,104.391,114.194,104.700Q114.116,105.010,114.024,105.315Q113.931,105.621,113.823,105.921Q113.716,106.222,113.594,106.517Q113.472,106.811,113.335,107.100Q113.199,107.388,113.048,107.670Q112.898,107.951,112.734,108.225Q112.570,108.499,112.392,108.764Q112.215,109.029,112.025,109.286Q111.835,109.542,111.632,109.789Q111.430,110.035,111.216,110.272Q111.001,110.508,110.776,110.734Q110.550,110.960,110.314,111.174Q110.077,111.388,109.830,111.591Q109.584,111.793,109.327,111.983Q109.071,112.173,108.806,112.351Q108.540,112.528,108.267,112.692Q107.993,112.856,107.712,113.007Q107.430,113.157,107.142,113.294Q106.853,113.430,106.558,113.552Q106.263,113.674,105.963,113.782Q105.662,113.889,105.357,113.982Q105.052,114.075,104.742,114.152Q104.433,114.230,104.120,114.292Q103.807,114.354,103.491,114.401Q103.175,114.448,102.858,114.479Q102.540,114.510,102.221,114.526Q101.902,114.542,101.583,114.542Q101.264,114.542,100.945,114.526Q100.627,114.510,100.309,114.479Q99.992,114.448,99.676,114.401Q99.360,114.354,99.047,114.292Q98.734,114.230,98.425,114.152Q98.115,114.075,97.810,113.982Q97.504,113.889,97.204,113.782Q96.903,113.674,96.608,113.552Q96.314,113.430,96.025,113.294Q95.737,113.157,95.455,113.007Q95.174,112.856,94.900,112.692Q94.626,112.528,94.361,112.351Q94.096,112.173,93.839,111.983Q93.583,111.793,93.336,111.591Q93.090,111.388,92.854,111.174Q92.617,110.960,92.391,110.734Q92.165,110.508,91.951,110.272Q91.737,110.035,91.534,109.789Q91.332,109.542,91.142,109.286Q90.952,109.029,90.774,108.764Q90.597,108.499,90.433,108.225Q90.269,107.951,90.118,107.670Q89.968,107.388,89.831,107.100Q89.695,106.811,89.573,106.517Q89.451,106.222,89.343,105.921Q89.236,105.621,89.143,105.315Q89.050,105.010,88.973,104.700Q88.895,104.391,88.833,104.078Q88.771,103.765,88.724,103.449Q88.677,103.133,88.646,102.816Q88.615,102.498,88.599,102.180Q88.583,101.861,88.583,101.542Q88.583,101.223,88.599,100.904Q88.615,100.585,88.646,100.267Q88.677,99.950,88.724,99.634Q88.771,99.319,88.833,99.005Q88.895,98.693,88.973,98.383Q89.050,98.073,89.143,97.768Q89.236,97.463,89.343,97.162Q89.451,96.862,89.573,96.567Q89.695,96.272,89.831,95.983Q89.968,95.695,90.118,95.414Q90.269,95.132,90.433,94.858Q90.597,94.585,90.774,94.319Q90.952,94.054,91.142,93.798Q91.332,93.541,91.534,93.295Q91.737,93.048,91.951,92.811Q92.165,92.575,92.391,92.349Q92.617,92.124,92.854,91.909Q93.090,91.695,93.336,91.493Q93.583,91.290,93.839,91.100Q94.096,90.910,94.361,90.733Q94.626,90.555,94.900,90.391Q95.174,90.227,95.455,90.077Q95.737,89.926,96.025,89.790Q96.314,89.653,96.608,89.531Q96.903,89.409,97.204,89.302Q97.504,89.194,97.810,89.101Q98.115,89.009,98.425,88.931Q98.734,88.854,99.047,88.791Q99.360,88.729,99.676,88.682Q99.992,88.636,100.309,88.604Q100.627,88.573,100.945,88.557Q101.264,88.542,101.583,88.542Q101.902,88.542,102.221,88.557Q102.540,88.573,102.858,88.604Q103.175,88.636,103.491,88.682Q103.807,88.729,104.120,88.791Q104.433,88.854,104.742,88.931Q105.052,89.009,105.357,89.101Q105.662,89.194,105.963,89.302Q106.263,89.409,106.558,89.531Q106.853,89.653,107.142,89.790Q107.430,89.926,107.712,90.077Q107.993,90.227,108.267,90.391Q108.540,90.555,108.806,90.733Q109.071,90.910,109.327,91.100Q109.584,91.290,109.830,91.493Q110.077,91.695,110.314,91.909Q110.550,92.124,110.776,92.349Q111.001,92.575,111.216,92.811Q111.430,93.048,111.632,93.295Q111.835,93.541,112.025,93.798Q112.215,94.054,112.392,94.319Q112.570,94.585,112.734,94.858Q112.898,95.132,113.048,95.414Q113.199,95.695,113.335,95.983Q113.472,96.272,113.594,96.567Q113.716,96.862,113.823,97.162Q113.931,97.463,114.024,97.768Q114.116,98.073,114.194,98.383Q114.271,98.693,114.334,99.005Q114.396,99.319,114.443,99.634Q114.489,99.950,114.521,100.267Q114.552,100.585,114.568,100.904Q114.583,101.223,114.583,101.542Z"
          fill="currentColor"
          opacity="0.5"
          className="text-yellow-500 dark:text-amber-400"
        />

        {/* Second orbital circle (with moving dot) */}
        {/* Path for the orbit */}
        <path
          id={orbitPathId}
          d="M109,160Q109,160.246,108.988,160.491Q108.976,160.736,108.952,160.980Q108.928,161.224,108.892,161.467Q108.856,161.710,108.808,161.951Q108.760,162.192,108.700,162.430Q108.641,162.668,108.569,162.903Q108.498,163.138,108.415,163.369Q108.333,163.600,108.239,163.827Q108.145,164.054,108.040,164.276Q107.935,164.498,107.819,164.714Q107.704,164.931,107.577,165.141Q107.451,165.352,107.315,165.556Q107.178,165.760,107.032,165.957Q106.886,166.154,106.730,166.344Q106.574,166.534,106.410,166.716Q106.245,166.898,106.071,167.071Q105.898,167.245,105.716,167.410Q105.534,167.574,105.344,167.730Q105.154,167.886,104.957,168.032Q104.760,168.178,104.556,168.315Q104.352,168.451,104.141,168.577Q103.931,168.704,103.714,168.819Q103.498,168.935,103.276,169.040Q103.054,169.145,102.827,169.239Q102.600,169.333,102.369,169.415Q102.138,169.498,101.903,169.569Q101.668,169.641,101.430,169.700Q101.192,169.760,100.951,169.808Q100.710,169.856,100.467,169.892Q100.224,169.928,99.980,169.952Q99.736,169.976,99.491,169.988Q99.245,170,99,170Q98.755,170,98.509,169.988Q98.264,169.976,98.020,169.952Q97.776,169.928,97.533,169.892Q97.290,169.856,97.049,169.808Q96.808,169.760,96.570,169.700Q96.332,169.641,96.097,169.569Q95.862,169.498,95.631,169.415Q95.400,169.333,95.173,169.239Q94.946,169.145,94.724,169.040Q94.503,168.935,94.286,168.819Q94.070,168.704,93.859,168.577Q93.648,168.451,93.444,168.315Q93.240,168.178,93.043,168.032Q92.846,167.886,92.656,167.730Q92.466,167.574,92.284,167.410Q92.103,167.245,91.929,167.071Q91.755,166.898,91.590,166.716Q91.426,166.534,91.270,166.344Q91.114,166.154,90.968,165.957Q90.822,165.760,90.685,165.556Q90.549,165.352,90.423,165.141Q90.296,164.931,90.181,164.714Q90.065,164.498,89.960,164.276Q89.855,164.054,89.761,163.827Q89.667,163.600,89.585,163.369Q89.502,163.138,89.431,162.903Q89.359,162.668,89.300,162.430Q89.240,162.192,89.192,161.951Q89.144,161.710,89.108,161.467Q89.072,161.224,89.048,160.980Q89.024,160.736,89.012,160.491Q89.000,160.246,89.000,160Q89.000,159.755,89.012,159.509Q89.024,159.264,89.048,159.020Q89.072,158.776,89.108,158.533Q89.144,158.290,89.192,158.049Q89.240,157.808,89.300,157.570Q89.359,157.332,89.431,157.097Q89.502,156.862,89.585,156.631Q89.667,156.400,89.761,156.173Q89.855,155.946,89.960,155.724Q90.065,155.503,90.181,155.286Q90.296,155.070,90.423,154.859Q90.549,154.648,90.685,154.444Q90.822,154.240,90.968,154.043Q91.114,153.846,91.270,153.656Q91.426,153.466,91.590,153.284Q91.755,153.103,91.929,152.929Q92.103,152.755,92.284,152.590Q92.466,152.426,92.656,152.270Q92.846,152.114,93.043,151.968Q93.240,151.822,93.444,151.685Q93.648,151.549,93.859,151.423Q94.070,151.297,94.286,151.181Q94.503,151.065,94.724,150.960Q94.946,150.855,95.173,150.761Q95.400,150.667,95.631,150.585Q95.862,150.502,96.097,150.431Q96.332,150.359,96.570,150.300Q96.808,150.240,97.049,150.192Q97.290,150.144,97.533,150.108Q97.776,150.072,98.020,150.048Q98.264,150.024,98.509,150.012Q98.755,150,99,150Q99.245,150,99.491,150.012Q99.736,150.024,99.980,150.048Q100.224,150.072,100.467,150.108Q100.710,150.144,100.951,150.192Q101.192,150.240,101.430,150.300Q101.668,150.359,101.903,150.431Q102.138,150.502,102.369,150.585Q102.600,150.667,102.827,150.761Q103.054,150.855,103.276,150.960Q103.498,151.065,103.714,151.181Q103.931,151.297,104.141,151.423Q104.352,151.549,104.556,151.685Q104.760,151.822,104.957,151.968Q105.154,152.114,105.344,152.270Q105.534,152.426,105.716,152.590Q105.898,152.755,106.071,152.929Q106.245,153.103,106.410,153.284Q106.574,153.466,106.730,153.656Q106.886,153.846,107.032,154.043Q107.178,154.240,107.315,154.444Q107.451,154.648,107.577,154.859Q107.704,155.070,107.819,155.286Q107.935,155.503,108.040,155.724Q108.145,155.946,108.239,156.173Q108.333,156.400,108.415,156.631Q108.498,156.862,108.569,157.097Q108.641,157.332,108.700,157.570Q108.760,157.808,108.808,158.049Q108.856,158.290,108.892,158.533Q108.928,158.776,108.952,159.020Q108.976,159.264,108.988,159.509Q109,159.755,109,160Z"
          fill="none"
          stroke="currentColor"
          strokeOpacity="0.3"
          strokeWidth="1"
          className="text-indigo-400"
        />

        {/* The orbital dot (animated) */}
        <circle
          cx={orbitalPosition.x}
          cy={orbitalPosition.y}
          r="4"
          fill="currentColor"
          className={`${isRunning ? 'animate-pulse' : ''} text-yellow-500 dark:text-amber-400`}
          style={{
            transition: `transform ${speed * 0.01}s linear`,
          }}
        />

        {/* Third orbital ring with innercut */}
        <path
          d="M103.672,148.944Q101.440,148,99,148Q96.560,148,94.328,148.944Q92.175,149.855,90.515,151.515Q88.855,153.175,87.944,155.328Q87,157.560,87,160Q87,162.440,87.944,164.672Q88.855,166.825,90.515,168.485Q92.175,170.145,94.328,171.056Q96.560,172,99,172Q101.440,172,103.672,171.056Q105.825,170.145,107.485,168.485Q109.145,166.825,110.056,164.672Q111,162.440,111,160Q111,157.560,110.056,155.328Q109.145,153.175,107.485,151.515Q105.825,149.855,103.672,148.944ZM93.343,154.343Q95.686,152,99,152Q102.314,152,104.657,154.343Q107,156.686,107,160Q107,163.314,104.657,165.657Q102.314,168,99,168Q95.686,168,93.343,165.657Q91,163.314,91,160Q91,156.686,93.343,154.343Z"
          fillRule="evenodd"
          fill="currentColor"
          opacity="0.7"
          className="text-indigo-400"
        />

        {/* Animated pulse effect for the nucleus */}
        <circle
          cx="99"
          cy="99"
          r="20"
          fill="currentColor"
          opacity="0.3"
          className={`${isRunning ? 'animate-pulse' : ''} text-indigo-500 dark:text-indigo-400`}
        />
      </svg>

      {/* Add animation keyframes for orbit */}
      <style>{`
        @keyframes orbit {
          0% {
            transform: rotate(0deg) translateX(40px) rotate(0deg);
          }
          100% {
            transform: rotate(360deg) translateX(40px) rotate(-360deg);
          }
        }
      `}</style>
    </div>
  );
}
